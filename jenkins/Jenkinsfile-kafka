pipeline {
    agent any
    
    stages {
        stage('Deploy Kafka (KRaft) to dev') {
            steps {
                sh """
                helm upgrade --install microbank-umbrella . \\
                  --set kafka.enabled=true \\
                  --set kafka.kraft.enabled=true \\
                  --set kafka.controller.replicaCount=3 \\
                  --namespace dev --create-namespace
                """
            }
        }
        stage('Deploy Kafka (KRaft) to test') {
            steps {
                sh """
                helm upgrade --install microbank-umbrella . \\
                  --set kafka.enabled=true \\
                  --set kafka.kraft.enabled=true \\
                  --set kafka.controller.replicaCount=3 \\
                  --namespace test --create-namespace
                """
            }
        }
        stage('Deploy Kafka (KRaft) to prod') {
            steps {
                sh """
                helm upgrade --install microbank-umbrella . \\
                  --set kafka.enabled=true \\
                  --set kafka.kraft.enabled=true \\
                  --set kafka.controller.replicaCount=3 \\
                  --namespace prod --create-namespace
                """
            }
        }
    }
}