<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{../layout :: content}">
<div class="grid grid--3">
    <section class="card" style="grid-column: span 2;">
        <h2 class="card__title">Аккаунт</h2>
        <p class="card__hint">Управление профилем и счетами</p>

            <form class="form" th:action="@{'/user/' + ${login} + '/editUserAccounts'}" method="post">
                <div class="grid grid--2">
                    <div class="form__row">
                        <label class="label">ФИО</label>
                        <div class="help" th:text="${name}">Иванов Иван</div>
                        <input class="input" name="name" type="text" placeholder="Новое ФИО" />
                    </div>
                    <div class="form__row">
                        <label class="label">Дата рождения</label>
                        <div class="help" th:text="${birthdate}">1990-01-01</div>
                        <input class="input" name="birthdate" type="date" />
                    </div>
                </div>

                <div class="form__row">
                    <label class="label">Счета</label>
                    <div class="grid grid--3">
                        <label class="row center" style="gap:8px" th:each="acc : ${accounts}">
                            <input type="checkbox" name="account" th:value="${acc.currency.name()}" th:checked="${acc.exists}" />
                            <span th:text="${acc.currency.title}">USD</span>
                            <span class="muted" th:if="${acc.exists}" th:text="${acc.value + ' ' + acc.currency.name()}"></span>
                        </label>
                    </div>
                </div>

                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="row between center">
                    <span class="error" th:each="e : ${userAccountsErrors}" th:text="${e}"></span>
                    <button class="btn" type="submit">Сохранить</button>
                </div>
            </form>
        </section>

        <!-- 2. Смена пароля -->
        <section class="card">
            <h2 class="card__title">Безопасность</h2>
            <form class="form" th:action="@{'/user/' + ${login} + '/editPassword'}" method="post">
                <div class="form__row">
                    <label class="label">Новый пароль</label>
                    <input class="input" name="password" type="password" required />
                </div>
                <div class="form__row">
                    <label class="label">Повторите пароль</label>
                    <input class="input" name="confirm_password" type="password" required />
                </div>
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="row between center">
                    <span class="error" th:each="e : ${passwordErrors}" th:text="${e}"></span>
                    <button class="btn" type="submit">Изменить</button>
                </div>
            </form>
        </section>

        <!-- 3. Внесение / снятие -->
        <section class="card">
            <h2 class="card__title">Наличные</h2>
            <form class="form" th:action="@{'/user/' + ${login} + '/cash'}" method="post">
                <div class="grid grid--2">
                    <div class="form__row">
                        <label class="label">Валюта</label>
                        <select class="select" name="currency">
                            <option th:each="c : ${currency}" th:value="${c.name()}" th:text="${c.title}"></option>
                        </select>
                    </div>
                    <div class="form__row">
                        <label class="label">Сумма</label>
                        <input class="input" name="value" type="number" step="0.01" min="0" required />
                    </div>
                </div>
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="row between center">
                    <span class="error" th:each="e : ${cashErrors}" th:text="${e}"></span>
                    <div class="row" style="gap:10px">
                        <button class="btn" name="action" value="PUT">Положить</button>
                        <button class="btn btn--ghost" name="action" value="GET">Снять</button>
                    </div>
                </div>
            </form>
        </section>

        <!-- 4. Перевод между своими счетами -->
        <section class="card" style="grid-column: span 2;">
            <h2 class="card__title">Перевод между своими счетами</h2>
            <form class="form" th:action="@{'/user/' + ${login} + '/transfer'}" method="post">
                <div class="grid grid--3">
                    <div class="form__row">
                        <label class="label">Со счёта</label>
                        <select class="select" name="from_currency">
                            <option th:each="c : ${currency}" th:value="${c.name()}" th:text="${c.title}"></option>
                        </select>
                    </div>
                    <div class="form__row">
                        <label class="label">На счёт</label>
                        <select class="select" name="to_currency">
                            <option th:each="c : ${currency}" th:value="${c.name()}" th:text="${c.title}"></option>
                        </select>
                    </div>
                    <div class="form__row">
                        <label class="label">Сумма</label>
                        <input class="input" name="value" type="number" step="0.01" min="0" required />
                    </div>
                </div>
                <input type="hidden" name="to_login" th:value="${login}" />
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="row between center">
                    <span class="error" th:each="e : ${transferErrors}" th:text="${e}"></span>
                    <button class="btn" type="submit">Перевести</button>
                </div>
            </form>
        </section>

        <!-- 5. Перевод другому аккаунту -->
        <section class="card" style="grid-column: span 2;">
            <h2 class="card__title">Перевод другому пользователю</h2>
            <form class="form" th:action="@{'/user/' + ${login} + '/transfer'}" method="post">
                <div class="grid grid--3">
                    <div class="form__row">
                        <label class="label">Со счёта</label>
                        <select class="select" name="from_currency">
                            <option th:each="c : ${currency}" th:value="${c.name()}" th:text="${c.title}"></option>
                        </select>
                    </div>
                    <div class="form__row">
                        <label class="label">На счёт</label>
                        <select class="select" name="to_currency">
                            <option th:each="c : ${currency}" th:value="${c.name()}" th:text="${c.title}"></option>
                        </select>
                    </div>
                    <div class="form__row">
                        <label class="label">Сумма</label>
                        <input class="input" name="value" type="number" step="0.01" min="0" required />
                    </div>
                </div>
                <div class="grid grid--2">
                    <div class="form__row">
                        <label class="label">Получатель</label>
                        <select class="select" name="to_login">
                            <option th:each="u : ${users}" th:value="${u.login}" th:text="${u.name}"></option>
                        </select>
                    </div>
                </div>
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="row between center">
                    <span class="error" th:each="e : ${transferOtherErrors}" th:text="${e}"></span>
                    <button class="btn" type="submit">Перевести</button>
                </div>
            </form>
        </section>

        <!-- 6. Курсы валют -->
        <div th:replace="~{../fragments/rates :: section}"></div>
    </div>
</html>