# Сервис конвертации валют

Микросервис для обработки курсов валют и выполнения операций конвертации. Получает актуальные курсы от сервиса генерации (exchange-generator-service) через REST API, предоставляет курсы для фронтенда и выполняет конвертацию для account-service.

Хранит информацию о конвертации валюты при её покупке/продаже.

## Основные возможности

- Получение курсов: Принимает курсы валют от сервиса генерации каждую секунду через endpoint /api/exchange/update-rates и хранит их в in-memory кэше.
- API для фронтенда: Предоставляет курсы валют (RUB как базовая) через /api/exchange/rates и список доступных валют через /api/exchange/currencies.
- API для конвертации: Выполняет конвертацию валют через /api/exchange/convert для account-service.
- Хранение операций: Сохраняет историю конвертаций в PostgreSQL с использованием R2DBC.

## Логика работы

- Обновление курсов: Сервис принимает Flux<ExchangeRateDto> от Generator через /api/exchange/update-rates, очищает кэш и обновляет его новыми курсами.
- Кэширование: Курсы хранятся в ConcurrentHashMap для быстрого доступа.
- Конвертация: Для пар, не включающих RUB, курс рассчитывается через RUB (кросс-курсы). Спред (0.5%) и округление (4 знака) настраиваются через application.yml.
- Сохранение операций: Каждая конвертация сохраняется в таблицу operations с userId, валютами, суммами, курсом и типом операции (BUY/SELL).

## API

API документировано в openapi.yml.

Основные endpoints:

- GET /api/exchange/rates: Курсы валют (RUB как базовая) для фронтенда.
- GET /api/exchange/rates/{from}/{to}: Курс для конкретной пары.
- POST /api/exchange/convert: Конвертация для account-service.
- GET /api/exchange/currencies: Список доступных валют.
- POST /api/exchange/update-rates: Обновление курсов от Generator.